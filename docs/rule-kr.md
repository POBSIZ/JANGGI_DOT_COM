## 한국 장기 규칙 (AI 구현용 정리)

한국 장기의 규칙을 **AI가 읽고 그대로 구현할 수 있도록** 정리한 문서입니다.  
표현은 자연어이지만, 가능한 한 **형식적으로 해석**할 수 있게 작성했습니다.

이 문서는 다음 두 층위를 함께 다룹니다.

- **표준 규칙**: 실제 한국 장기에서 통용되는 규칙을 기술합니다 (주로 1~7장).
- **프로젝트 규칙/옵션**: 이 프로젝트의 AI 엔진에서만 사용하는 고정 상차림, 점수제(+1.5), 구현상의 단순화·제한 등을 별도로 명시합니다 (3.3, 8, 9장 등).

문맥상 “프로젝트 규칙/옵션”이라고 밝힌 부분은 **실제 장기 공식 규정이 아니라,
이 엔진이 채택한 정책**이라는 점에 유의해야 합니다.

---

## 1. 보드와 좌표계

- **보드 크기**

  - 가로 9줄 × 세로 10줄 = **90개의 교차점**.
  - 장기는 **선의 교차점에 기물을 둔다** (체스처럼 칸 안이 아님).

- **궁성(宮城, Palace)**

  - 한(아래 진영)과 초(위 진영) 중앙에 각각 3×3 크기의 궁성이 1개씩 있음.
  - 각 궁성 내부에는 대각선이 그려져 있고, 이 대각선 선도 **기물 이동 경로**로 사용됨.

- **좌표계 정의 (권장 예시)**
  - 가로 파일: 왼쪽에서 오른쪽으로 `a b c d e f g h i` (9열).
  - 세로 랭크: 아래에서 위로 `1 2 ... 10` (10행).
  - **한(아래 진영)**: “앞으로” = 랭크 증가 방향 (예: `3 → 4`).
  - **초(위 진영)**: “앞으로” = 랭크 감소 방향 (예: `8 → 7`).

예시:

- `a1`: 한의 왼쪽 맨 아래 모서리.
- `e2`: 한 궁의 정 가운데 교차점.
- `e9`: 초 궁의 정 가운데 교차점.

---

## 2. 기물 종류

각 진영(한/초)은 아래 기물을 각각 **16개**씩 가진다.

- **궁(宮, 한/초 공통)**: 1개 (킹 역할)
- **사(士)**: 2개
- **상(象)**: 2개
- **마(馬)**: 2개
- **차(車)**: 2개
- **포(包)**: 2개
- **졸/병(卒/兵)**: 5개

AI 구현 시에는 보통 아래와 같이 타입을 나누면 된다.

- 진영: `HAN`, `CHO`
- 기물 종류: `KING`, `GUARD`, `ELEPHANT`, `HORSE`, `ROOK`, `CANNON`, `PAWN`

---

## 3. 초기 배치 (정확 좌표)

### 3.1 한(아래 진영, 후수)

한은 **아래에서 위를 바라본 기준**으로 다음과 같이 배치한다.

- **1랭크 (`a1` ~ `i1`)**

  - `a1`: 차 (HAN_ROOK)
  - `b1`: 마 (HAN_HORSE)
  - `c1`: 상 (HAN_ELEPHANT)
  - `d1`: 사 (HAN_GUARD)
  - `e1`: (초기에는 비어 있음)
  - `f1`: 사 (HAN_GUARD)
  - `g1`: 상 (HAN_ELEPHANT)
  - `h1`: 마 (HAN_HORSE)
  - `i1`: 차 (HAN_ROOK)

- **2랭크**

  - `e2`: 궁 (HAN_KING) — 한 궁성의 정 가운데

- **3랭크**

  - `b3`: 포 (HAN_CANNON)
  - `h3`: 포 (HAN_CANNON)

- **4랭크**

  - `a4`: 졸 (HAN_PAWN)
  - `c4`: 졸 (HAN_PAWN)
  - `e4`: 졸 (HAN_PAWN)
  - `g4`: 졸 (HAN_PAWN)
  - `i4`: 졸 (HAN_PAWN)

- **한의 궁성 영역**
  - 파일: `d e f`
  - 랭크: `1 2 3`
  - 즉, `d1 ~ f3` 3×3 영역이 한의 궁성.

### 3.2 초(위 진영, 선공)

초는 한을 **상하 반전**한 형태로 배치한다.

- **10랭크 (`a10` ~ `i10`)**

  - `a10`: 차 (CHO_ROOK)
  - `b10`: 마 (CHO_HORSE)
  - `c10`: 상 (CHO_ELEPHANT)
  - `d10`: 사 (CHO_GUARD)
  - `e10`: (초기에는 비어 있음)
  - `f10`: 사 (CHO_GUARD)
  - `g10`: 상 (CHO_ELEPHANT)
  - `h10`: 마 (CHO_HORSE)
  - `i10`: 차 (CHO_ROOK)

- **9랭크**

  - `e9`: 궁 (CHO_KING) — 초 궁성의 정 가운데

- **8랭크**

  - `b8`: 포 (CHO_CANNON)
  - `h8`: 포 (CHO_CANNON)

- **7랭크**

  - `a7`: 병 (CHO_PAWN)
  - `c7`: 병 (CHO_PAWN)
  - `e7`: 병 (CHO_PAWN)
  - `g7`: 병 (CHO_PAWN)
  - `i7`: 병 (CHO_PAWN)

- **초의 궁성 영역**
  - 파일: `d e f`
  - 랭크: `8 9 10`
  - 즉, `d8 ~ f10` 3×3 영역이 초의 궁성.

### 3.3 상차림(초기 포진) 설명

- **상차림의 의미**

  - 상차림은 장기에서 **대국을 시작할 때 기물을 어떻게 배치해 두는지**를 뜻한다.
  - 전통 규칙에서 1랭크의 바깥자리(파일 `a`·`i`)에는 항상 차가,  
    가운데 궁성 쪽 세 칸(`d`, `e`, `f`)에는 사·(공백)·사가 위치한다.
  - 그 사이 네 칸(`b`, `c`, `g`, `h`)은 **마와 상이 섞여 들어가는 자리**로,
    규칙상 **이 네 칸에서 마와 상의 순서만 자유롭게 바꿀 수 있다.**
  - 궁은 1랭크가 아니라, 각 진영 궁성의 정 가운데(`e2`, `e9`)에서 시작하며,  
    포는 그 앞줄, 졸/병은 그 앞앞줄에 배치된다.

- **마·상 배치의 자유 (4가지 상차림)**

  - 마·상 네 칸(`b1, c1, g1, h1` / `b10, c10, g10, h10`)에서의 배치에 따라
    대표적으로 다음 네 가지 상차림이 구분된다.
    - **원상차림** (다른 이름: `상마상마`, `귀마`)
    - **오른상차림** (다른 이름: `마상마상`, `귀마`)
    - **안상차림** (다른 이름: `마상상마`, `원양마`)
    - **바깥상차림** (다른 이름: `상마마상`, `양귀마`)
  - 괄호 안의 네 글자 표기는  
    **왼쪽부터 `b1, c1, g1, h1` 자리에 놓인 마·상의 순서**를 의미한다.
    - 예: `마상상마`라면
      - 한 진영 기준 `b1=마, c1=상, g1=상, h1=마` 배치를 뜻한다.
  - 단, **마 마 상 상**, **상 상 마 마**처럼 한쪽 측면에 마/상이 둘 다 몰려 있는 형태는  
    균형 문제가 있어 **규칙상 허용되지 않는다.**

- **이 문서에서 사용하는 상차림 (프로젝트 규칙)**

  - 이 규칙서는 위의 전통적인 상차림 개념을 참고하되,
    구현 단순화를 위해 다음과 같이 **고정된 좌표 상차림**만을 사용한다.
    - 1랭크의 마·상 배열은 **안상차림(`마상상마`)**으로 고정한다.
      - 한: `b1=마, c1=상, g1=상, h1=마`
      - 초: `b10=마, c10=상, g10=상, h10=마`
    - 나머지 기물 배치는 다음과 같다.
      - 한: 2랭크 `e2`에 궁, 3랭크 `b3`·`h3`에 포, 4랭크 `a4`·`c4`·`e4`·`g4`·`i4`에 졸.
      - 초: 9랭크 `e9`에 궁, 8랭크 `b8`·`h8`에 포, 7랭크 `a7`·`c7`·`e7`·`g7`·`i7`에 병.
  - 즉, **궁은 궁성의 정 가운데에서 시작하고**,  
    **포는 궁 바로 앞줄 양쪽**, **졸/병은 그 앞줄 다섯 자리에 일렬 배치**되는 형태다.

- **변형 상차림에 대한 처리**
  - 실제 장기에서는 포의 위치나 졸/병의 줄 수를 바꾸는 **지역 규칙·변형 상차림**도 존재한다.
  - 그러나 이 문서와 AI 엔진은 **위에 명시된 고정 상차림만을 지원**하며,
    다른 상차림은 별도의 옵션을 추가하지 않는 한 고려하지 않는다.

---

## 4. 기본 규칙 (턴, 이동, 포획)

- **턴 진행**

  - 초가 먼저 둔다.
  - 이후 초 → 한 → 초 → 한 … 순서로 1수씩 번갈아 둔다.

- **이동과 포획**

  - 한 턴에 **한 기물만** 움직일 수 있다.
  - 기물은 자신의 이동 규칙에 따라 **빈 교차점**으로 이동하거나,
    도착 위치의 **상대 기물을 포획**할 수 있다.
  - 도착 위치에 **아군 기물**이 있으면 이동 불가.

- **경로 차단 (Blocking)**

  - 차, 포, 상, 마 등은 이동 경로 중간에 다른 기물이 있으면
    (규칙에 따라) 이동이 제한된다.  
    각 기물별 상세 규칙은 아래 섹션 참조.

- **자기 왕 보호**
  - 어떤 수를 두더라도, 결과 상태에서 **자신의 궁(왕)이 공격받는 상태**이면
    그 수는 **불법 수**이다.
  - 즉, “자기 왕을 장군에 노출시키는” 수는 둘 수 없다.

---

## 5. 기물별 이동 규칙

아래 설명에서 “한 칸”은 인접한 교차점 하나를 의미한다.

### 5.1 궁(宮, KING)

- **이동 범위**

  - 반드시 **자신의 궁성(3×3 영역)** 안에서만 이동 가능.
  - 궁성 밖으로 나가는 수는 불법.

- **이동 방식**

  - 상/하/좌/우로 1칸 (직선 4방향).
  - 궁성 내부의 대각선 선을 따라 **대각선으로 1칸** 이동 가능.

- **포획**

  - 이동 가능한 칸에 있는 **상대 기물**을 포획.

- **대면 금지 (궁끼리 마주보기 금지)**
  - 양쪽 궁이 **같은 파일(세로선)** 위에 있고,
  - 그 사이에 **어떤 기물도 없으면**, 이 상태는 **불법 상태**이다.
  - 이런 상태를 만드는 수, 혹은 그대로 유지하는 수는 모두 불법.

### 5.2 사(士, GUARD)

- **이동 범위**

  - **자신의 궁성 내부**에서만 이동 가능.

- **이동 방식**

  - 궁성 내부에서 **전, 후, 좌, 우로 1칸** 이동 가능 (직선 이동).
  - **대각선으로 1칸** 이동은 **궁성 내부의 X자 대각선 선의 교차점에 있을 때만** 가능.
    - 궁성에는 X자 형태의 대각선이 그려져 있으며, 사는 **이 대각선 위의 점에 있을 때만** 대각선 이동이 가능하다.
    - 대각선 위의 점: **4개의 모서리 + 정 가운데 (총 5개 점)**
    - 한의 궁성 대각선 점: `d1`, `f1`, `e2` (중앙), `d3`, `f3`
    - 초의 궁성 대각선 점: `d8`, `f8`, `e9` (중앙), `d10`, `f10`
    - 예: `e2`(중앙)에 있는 사는 `d1`, `f1`, `d3`, `f3` 네 방향으로 대각선 이동 가능.
    - 예: `d1`(모서리)에 있는 사는 `e2`(중앙)로만 대각선 이동 가능.
    - **궁성 내의 모서리/중앙이 아닌 점** (예: `d2`, `e1`, `e3`, `f2`)에서는 대각선 이동 불가.

- **포획**
  - 이동 가능한 칸의 상대 기물을 포획.

### 5.3 상(象, ELEPHANT)

- **이동 범위**

  - 보드 전체에서 사용 가능 (궁성 안/밖 모두 가능).

- **이동 방식 (직선 1칸 + 같은 방향 대각선 2칸)**

  - 먼저 상/하/좌/우 중 한 방향으로 **직선 1칸** 나간 뒤,
  - 그 지점에서 **같은 방향으로 확장되는 대각선으로 2칸** 이동한다.
  - **중요**: 대각선 방향은 반드시 **직선 이동 방향의 연장선**이어야 한다.
    - 오른쪽(→)으로 직선 1칸 이동 시: 대각선은 **오른쪽 위(↗)** 또는 **오른쪽 아래(↘)**만 가능
    - 왼쪽(←)으로 직선 1칸 이동 시: 대각선은 **왼쪽 위(↖)** 또는 **왼쪽 아래(↙)**만 가능
    - 위(↑)로 직선 1칸 이동 시: 대각선은 **오른쪽 위(↗)** 또는 **왼쪽 위(↖)**만 가능
    - 아래(↓)로 직선 1칸 이동 시: 대각선은 **오른쪽 아래(↘)** 또는 **왼쪽 아래(↙)**만 가능
  - 전체적으로는 **3칸짜리 긴 L자 형태**로 이동한다고 이해할 수 있다.
  - 가능한 최종 도착점 (시작점 기준):
    - (+3, +2), (+3, -2), (-3, +2), (-3, -2)
    - (+2, +3), (+2, -3), (-2, +3), (-2, -3)
  - 이동 경로 중
    - 첫 번째 직선 1칸,
    - 그 다음 대각선 1칸  
      이 두 칸 중 **어느 칸에라도 기물(아군/적군)이 있으면 이동 불가**이다.

  **참고**: 이 규칙은 **한국 장기 표준 규칙**에 따른 것이다.  
  (일부 변형 규칙이나 중국 상기에서는 상이 대각선 2칸만 이동하는 형태로 정의되기도 하지만, 이 문서는 한국 장기 표준 규칙을 따르므로 위와 같이 정의한다.)

- **포획**
  - 도착 위치에 있는 상대 기물을 포획.

### 5.4 마(馬, HORSE)

- **이동 범위**

  - 보드 전체에서 사용 가능.

- **이동 방식 (직선 1칸 + 대각선 1칸)**

  - 먼저 상/하/좌/우 방향으로 **직선 1칸** 이동한 뒤,
  - 그 지점에서 **대각선 방향으로 1칸** 이동.
  - 전체적으로는 체스의 나이트와 비슷한 `L`자 형태이지만,
    첫 번째 직선 칸에 **어떤 기물이든 있으면 이동 불가** (마의 다리 막힘).

- **포획**
  - 최종 도착 칸에 있는 상대 기물을 포획.

### 5.5 차(車, ROOK)

- **이동 범위**

  - 보드 전체 + 두 궁성 내부의 대각선.

- **이동 방식**

  - 상/하/좌/우 방향으로 **임의의 칸 수** 이동 가능.
  - 이동 경로 중간에 **어떤 기물도 있어서는 안 됨** (점프 불가).
  - 궁성 내부 대각선도 “직선 경로”로 간주되므로, 궁성 안에서 대각선으로 연속 이동 가능.

- **포획**
  - 도착 위치에 있는 상대 기물을 포획.

### 5.6 포(包, CANNON)

포는 장기의 특징적인 기물로, **반드시 “스크린(받침) 기물”을 하나 뛰어넘어야** 이동할 수 있다.

- **공통 규칙**

  - 직선(상/하/좌/우) 방향 + 궁성 내부 대각선 방향으로만 이동.
  - 출발점과 도착점 사이에 **정확히 1개의 기물(스크린)** 이 있어야 한다.
  - 그 스크린 기물은 **포가 아닌 기물**이어야 한다. (포는 다른 포를 스크린으로 사용할 수 없음.)
  - 스크린 이외의 추가 기물이 출발~도착 사이에 있으면 이동 불가.

- **빈 칸으로 이동**

  - 도착 칸이 **빈 칸**이어야 한다.
  - 출발점과 도착점 사이에 **포가 아닌 기물 1개만** 존재 → 합법.

- **포획**
  - 도착 칸에 **상대 기물**이 있어야 한다.
  - 출발점과 도착점 사이에 **포가 아닌 기물 1개만** 존재 → 합법.

### 5.7 졸/병(卒/兵, PAWN)

- **기본 이동 방향**

  - 한: “앞” = 랭크 **+1** 방향 (숫자 증가, 위로 이동).
  - 초: “앞” = 랭크 **-1** 방향 (숫자 감소, 아래로 이동).

- **이동 방식**

  - 기본적으로 **앞으로 1칸**, 또는 **좌/우로 1칸** 이동 가능.
  - **뒤로 이동(후퇴)**는 어떤 경우에도 불가능.
  - **궁성 내부 특례**:
    - 졸/병이 궁성 내부에 위치한 경우,
      - 기본 이동(앞 1칸, 좌/우 1칸)에 더해,
      - 궁성에 그려진 대각선을 따라 **왼쪽 앞으로 1칸** 또는 **오른쪽 앞으로 1칸** 대각 이동도 가능하다.
    - 단, 대각선을 따라 **뒤로(후퇴 방향) 이동하는 것은 불가능**하다.
  - **상대 진영 끝줄(마지막 랭크) 도달 시**:
    - 한의 졸이 랭크 10, 초의 병이 랭크 1에 도달한 경우,
      - 더 이상 **앞으로도, 대각선 앞으로도 이동할 수 없으며**,
      - **좌/우로 1칸 이동만 가능**하다.

- **포획**
  - 이동 가능한 칸에 있는 상대 기물 포획.

---

## 6. 체크, 체크메이트, 스테일메이트

### 6.1 장군 (Check)

- 한 플레이어가 수를 둔 뒤, 상대 궁이 **다음 수에 바로 포획 가능한 상태**가 되면
  “장군을 불렀다”고 한다.
- 장군을 당한 쪽은 **다음 자신의 턴 1수 안에**:
  - 왕(궁)을 안전한 칸으로 이동하거나,
  - 공격 중인 기물을 포획하거나,
  - 공격 경로를 다른 기물로 차단하여,
  - 결과 상태에서 **자신의 왕이 더 이상 공격받지 않도록** 해야 한다.

### 6.2 체크메이트 (Checkmate)

아래 두 조건을 동시에 만족하면 체크메이트이다.

1. 현재 **자신의 차례**이다.
2. 현재 국면에서 **합법 수가 1개도 없고**, 동시에 **자신의 궁이 공격받는 상태**이다.

이때, 현재 차례인 플레이어가 **패배**하고 상대가 승리한다.

### 6.3 스테일메이트 (Stalemate)

장기에서는 스테일메이트도 **패배**로 취급한다.

- 현재 **자신의 차례**이고,
- 현재 국면에서 **합법 수가 1개도 없으며**,
- 동시에 **자신의 궁이 공격받고 있지 않다면**,
  - 이 상태는 스테일메이트이며,
  - **현재 차례인 플레이어가 패배**, 상대가 승리한다.

요약하면, 장기에서는

- 상대의 궁(왕)을 잡거나,
- 상대를 **어떤 수라도 둘 수 없는 상태**(체크 여부와 무관)에 빠뜨리면
  승리한다.

---

## 7. 반복, 빅장, 무승부

### 7.1 동일 국면 반복 (Repetition)

- 같은 기물 배치 + 같은 차례 정보가 **여러 번 반복되는 경우**,
  일반적으로 **무승부**로 처리한다.
- 실제 대회마다 “몇 번 반복 시 무승부로 할 것인지”는 다를 수 있다
  (예: 3회 반복 등).

### 7.2 빅장 (지속적 장군 반복)

- 한쪽이 계속해서 **장군만 반복적으로 부르며**  
  상대가 제대로 수를 둘 수 없도록 만드는 경우를 “빅장”이라고 한다.
- 현대 규정에서는 보통 **금지**되며,
  - 빅장을 건 쪽이 수를 바꾸지 않으면 **빅장을 건 쪽의 패배**로 처리하거나,
  - 규정에 따라 **무승부**로 처리할 수 있다.

### 7.3 기타 무승부

아래와 같은 경우는 대회/플랫폼 규정에 따라 무승부로 처리할 수 있다.

- 양측 합의로 더 이상 승부를 보지 않기로 한 경우.
- 매우 긴 수 동안 의미 있는 진전(포획/전진/공격 등)이 전혀 없는 경우.
- 반복 국면, 빅장 등과 결합한 특수 규칙.

---

## 8. 기물 가치와 점수제

사진 속 표를 기준으로 한 **표준적인 기물 점수 체계**는 다음과 같다.

- **궁 (KING)**: 점수 없음 (`-`)
  - 일반적으로 점수 계산에서 제외하거나, 이론적으로 **무한대 가치**로 본다.
- **차(ROOK)**: 13점 × 2기 = 26점
- **포(CANNON)**: 7점 × 2기 = 14점
- **마(HORSE)**: 5점 × 2기 = 10점
- **상(ELEPHANT)**: 3점 × 2기 = 6점
- **사(GUARD)**: 3점 × 2기 = 6점
- **졸/병(PAWN)**: 2점 × 5기 = 10점

이를 모두 합치면, **각 진영의 기물 총점은 72점**이 된다 (궁 제외).

- **총 기물 점수**: 72.0점
- 실제 규칙에서는 **후수(두 번째로 두는 쪽)** 에게 **+1.5점의 추가 점수**를 준다.
  - 이 소수점 1.5는 **무승부 방지용(코미와 유사)** 으로 사용된다.
  - 이 문서에서는 **초가 항상 선수**, **한이 항상 후수**이므로,
    **후수 보정 +1.5점은 한에게 적용된다.**
  - 예:
    - 초: 72.0점
    - 한: 73.5점

AI/엔진 입장에서 점수제를 사용하려면:

- **체크메이트나 스테일메이트로 끝난 경우**에는 점수와 무관하게 승패를 결정하고,
- 왕이 잡히지 않고 **기물만 남았을 때**나,
  반복, 빅장, 합의 등으로 **장군 여부와 무관하게 대국이 종료된 경우**에는  
  남은 기물 점수 + 후수 보정(+1.5)을 이용해 승/패/무승부를 판정할 수 있다.

**참고**: 이 점수제 및 +1.5 보정 규칙은 **실제 한국 장기의 필수 공식 규칙이라기보다는,
본 프로젝트와 일부 플랫폼에서 사용하는 평가용·무승부 방지용 옵션**에 가깝다.

---

## 9. AI 구현 관점 요약

### 9.1 상태 표현

- 필수 요소
  - 9×10 보드(교차점)에서 각 칸의 기물 정보 (없음 / (진영, 종류)).
  - 현재 차례 (HAN 또는 CHO).
- 선택 요소
  - 반복 국면 탐지를 위한 해시 (예: Zobrist hash).
  - 빅장 여부, 반복 횟수 등 메타데이터.

### 9.2 합법 수 생성

1. 현재 차례의 모든 기물에 대해,  
   위에서 정의한 이동 규칙에 따라 **가능한 이동 후보 리스트** 생성.
2. 각 후보 이동에 대해
   - 해당 수를 가상으로 적용한 뒤,
   - 결과 상태에서 **자기 진영의 장군이 공격받는지** 검사.
3. 자기 장군이 공격받는 결과를 만드는 수는 **합법 수 리스트에서 제거**.

### 9.3 종국 판정

1. 현재 차례 플레이어의 **합법 수 개수**를 센다.
2. 현재 상태에서 자기 장군이 공격받는지(체크인지)를 판정한다.
3. 다음과 같이 처리한다.
   - 합법 수 = 0 & 체크 상태 = 예 → **체크메이트 (현재 차례 패)**.
   - 합법 수 = 0 & 체크 상태 = 아니오 → **스테일메이트 (현재 차례 패)**.
   - 그 외 → 게임 계속.
